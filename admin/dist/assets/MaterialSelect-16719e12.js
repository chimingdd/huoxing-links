import{u as B}from"./propData-8a0097e5.js";import{u as F,_ as D,O as H}from"./index-eb0483c8.js";import{u as O}from"./curd-66c8d773.js";import{E as k}from"./element-plus-baf202ae.js";import{d as S,r as d,ag as f,o as V,c as z,Q as u,I as g,a as p,M as L,A as E,aq as N,O as I,u as i,P,a5 as Q,n as j,J,D as G,w as K,i as W}from"./@vue-d872a633.js";import X from"./cate-ef64fc7b.js";const Y={class:"upload-box"},Z=S({__name:"uploadImage",props:{modelValue:{},type:{},size:{},width:{},height:{},action:{default:"/api/materials"}},emits:["update:modelValue","query"],setup(v,{emit:y}){const c=y,e=v,s=d(),l=d(),n=d(!1),_={Authorization:"Bearer "+F.getToken()},h=a=>{if(e.type&&e.type.length>0||e.size){n.value=!0,console.log(a.size,"rawFile.size");const o=a.size<1024*1024*e.size,t=e.type.indexOf(a.type)>-1;if(!o)return k.warning(`图片大小不超过${e.size}M`),n.value=!1,!1;if(!t)return k.warning(`图片只能是${e.type.join(",")}格式!`),n.value=!1,!1}else return!0},x=a=>{n.value=!0,setTimeout(()=>{c("update:modelValue",a.path),k.success("上传成功"),c("query"),n.value=!1},1e3)};return(a,o)=>{const t=f("el-button"),M=f("el-upload");return V(),z("div",Y,[u(M,{ref_key:"uploadRef",ref:s,"file-list":l.value,"onUpdate:fileList":o[0]||(o[0]=w=>l.value=w),action:e.action,headers:_,name:"image","before-upload":h,"on-success":x},{file:g(()=>o[2]||(o[2]=[p("div",{style:{display:"none"}},null,-1)])),default:g(()=>[u(t,{type:"primary"},{default:g(()=>o[1]||(o[1]=[L("上传图片")])),_:1})]),_:1},8,["file-list","action"])])}}});const ee=D(Z,[["__scopeId","data-v-7a738714"]]),ae={class:"bottom_image"},te={class:"right_image"},oe={class:"right-top"},se={class:"num_icon"},le={class:"right_main"},ne={class:"right_image_main"},ie=["onClick"],ue=S({__name:"dialog",props:{max:{default:1},type:{default:"image"},kind:{default:"avatar"}},emits:["confirm"],setup(v,{expose:y,emit:c}){const e=d(!1),s=d(null),{state:l,query:n,sizeChangeHandle:_,currentChangeHandle:h}=O({url:"/materials",queryForm:{cate_id:s,page:1}}),x=c,a=v,o=B(()=>a.max,0),t=d([]),M=r=>{t.value.find(b=>b.id===r.id)?t.value=t.value.filter(b=>b.id!==r.id):t.value.length>=o.value?k.warning("最多只能选择"+o.value+"张图片"):t.value.push(r)},w=()=>{x("confirm",t.value.map(r=>r.path)),e.value=!1,j(()=>{t.value=[]})},U=()=>{t.value=[],e.value=!0},$=r=>{t.value=[],s.value=r,n()};return E("query",n),y({openDialog:U}),(r,C)=>{const b=f("el-button"),R=f("el-pagination"),T=f("el-dialog"),A=N("loading");return V(),z("div",null,[u(T,{modelValue:e.value,"onUpdate:modelValue":C[0]||(C[0]=m=>e.value=m),width:"900","append-to-body":!0,title:"素材库"},{default:g(()=>[p("div",ae,[p("div",te,[p("div",oe,[u(b,{type:"primary",class:"margin-right-20",onClick:w,disabled:t.value.length===0},{default:g(()=>[C[1]||(C[1]=L(" 使用选中图片 ")),p("div",se,"("+I(t.value.length)+" / "+I(i(o))+")",1)]),_:1},8,["disabled"]),u(ee,{onQuery:i(n)},null,8,["onQuery"])]),p("div",le,[u(X,{onRsCate:$}),p("div",ne,[(V(!0),z(P,null,Q(i(l).dataList,m=>J((V(),z("div",{class:G(["image",{on:t.value.find(q=>q.id===m.id)}]),key:m.id,onClick:q=>M(m)},[u(H,{paths:[m.path],width:100,height:100,disabled:!1},null,8,["paths"])],10,ie)),[[A,i(l).listLoading]])),128))]),u(R,{"current-page":i(l).page,total:i(l).total,"page-sizes":i(l).pageSizes,"page-size":i(l).limit,background:"",layout:"total,  prev, pager, next",onSizeChange:i(_),onCurrentChange:i(h)},null,8,["current-page","total","page-sizes","page-size","onSizeChange","onCurrentChange"])])])])]),_:1},8,["modelValue"])])}}});const re=D(ue,[["__scopeId","data-v-b4e62889"]]),de=S({__name:"MaterialSelect",props:{modelValue:{default:""},type:{default:"avatar"},max:{default:1}},emits:["update:modelValue"],setup(v,{emit:y}){const c=y,e=v,s=d([]);K(()=>e.modelValue,a=>{Array.isArray(a)?s.value=a:s.value=a?[a]:[]},{immediate:!0,deep:!0});const l=W(()=>e.max-s.value.length),n=()=>{e.max===1?c("update:modelValue",s.value[0]||""):c("update:modelValue",s.value)},_=d(),h=()=>{var a;s.value=[],(a=_.value)==null||a.openDialog()},x=a=>{s.value=s.value.concat(a),n()};return(a,o)=>{const t=f("el-button");return V(),z("div",null,[u(t,{type:"primary",onClick:h},{default:g(()=>o[0]||(o[0]=[L("素材库")])),_:1}),u(re,{kind:e==null?void 0:e.type,max:l.value,ref_key:"fileMangeDialogRef",ref:_,onConfirm:x},null,8,["kind","max"])])}}});const ve=D(de,[["__scopeId","data-v-506ffbc9"]]);export{ve as M,ee as U};
