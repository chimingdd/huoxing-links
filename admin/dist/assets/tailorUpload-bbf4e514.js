import{d as A,j as p,U as j,r as v,o as D,b as E,i as r,w as c,l as _,f as n,Y as x,an as C,g as F,ao as H,F as W,E as w,A as R,B as T}from"./.pnpm-0d809032.js";import{l as q,_ as L}from"./index-9afa9bfa.js";const Q="/web/assets/qqluodi-ee3584c7.png",z=g=>(R("data-v-d634c67f"),g=g(),T(),g),G={class:"avatar-container"},O=z(()=>n("div",null,"支持jpg、png格式的图片，大小不超过5M",-1)),Y={class:"avatar-crop"},$={class:"dialog-footer"},J=A({__name:"tailorUpload",props:{modelValue:{}},emits:["update:modelValue"],setup(g,{emit:k}){const B=p(),y=p(),h=p(),f=p(!1),m=p(!1),e=j({img:"",autoCrop:!0,fixedBox:!1,canMoveBox:!0,autoCropWidth:200,autoCropHeight:200,fixed:!0,fixedNumber:[1,1],centerBox:!0,canMove:!0,canScale:!0,full:!1}),U=s=>{const a=s.raw.type==="image/jpeg"||s.raw.type==="image/png",t=s.raw.size/1024/1024<5;if(!a)return w.warning("请选择 jpg、png 格式的图片"),!1;if(!t)return w.warning("图片大小不能超过 5MB"),!1;let l=new FileReader;l.readAsDataURL(s.raw),l.onload=d=>{e.img=d.target.result},h.value.clearFiles()},M=()=>{e.img="",f.value=!1},V=(s,a,t)=>{const l=new Image;let d=.8;l.src=s,l.setAttribute("crossOrigin","Anonymous");let i,u;l.onload=function(){i=l.width,u=l.height;const o=document.createElement("canvas"),b=o.getContext("2d");Math.max(i,u)>a?i>u?(o.width=a,o.height=a*u/i):(o.height=a,o.width=a*i/u):(o.width=i,o.height=u,d=.8),b.clearRect(0,0,o.width,o.height),b.drawImage(this,0,0,o.width,o.height);let N=o.toDataURL("image/jpeg",d);t(N)}},I=()=>{B.value.getCropData(s=>{V(s,300,a=>{q({image:a}).then(t=>{m.value=!1,k("update:modelValue",t.path||""),w.success("上传成功"),h.value.clearFiles(),M()}).catch(()=>{m.value=!1})})})},S=()=>{y.value.ref.click()};return(s,a)=>{const t=v("el-button"),l=v("el-upload"),d=v("el-dialog");return D(),E(W,null,[r(t,{type:"primary",onClick:a[0]||(a[0]=i=>f.value=!0)},{default:c(()=>[_("上传图片")]),_:1}),r(d,{title:"上传图片",modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=i=>f.value=i),"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":"",width:"600px"},{footer:c(()=>[n("div",$,[n("div",{class:"reupload",onClick:S},[x(n("span",null,"重新上传",512),[[C,e.img]])]),n("div",null,[r(t,{onClick:M,loading:m.value},{default:c(()=>[_("取 消")]),_:1},8,["loading"]),r(t,{type:"primary",onClick:I,loading:m.value},{default:c(()=>[_("确 定")]),_:1},8,["loading"])])])]),default:c(()=>[n("div",G,[x(n("div",null,[r(l,{class:"upload",ref_key:"tailorUpload",ref:h,action:"#","on-change":U,"show-file-list":!1,"auto-upload":!1},{default:c(()=>[r(t,{slot:"trigger",type:"primary",ref_key:"uploadBtn",ref:y},{default:c(()=>[_(" 选择图片 ")]),_:1},512)]),_:1},512),O],512),[[C,!e.img]]),x(n("div",Y,[r(F(H),{class:"crop-box",ref_key:"cropper",ref:B,img:e.img,autoCrop:e.autoCrop,fixedBox:e.fixedBox,canMoveBox:e.canMoveBox,autoCropWidth:e.autoCropWidth,autoCropHeight:e.autoCropHeight,centerBox:e.centerBox,fixed:e.fixed,fixedNumber:e.fixedNumber,canMove:e.canMove,canScale:e.canScale,full:e.full,outputSize:.1,outputType:"png"},null,8,["img","autoCrop","fixedBox","canMoveBox","autoCropWidth","autoCropHeight","centerBox","fixed","fixedNumber","canMove","canScale","full"])],512),[[C,e.img]])])]),_:1},8,["modelValue"])],64)}}});const X=L(J,[["__scopeId","data-v-d634c67f"]]);export{X as T,Q as _};
