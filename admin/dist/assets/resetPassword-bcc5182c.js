import{u as R}from"./propData-8a0097e5.js";import{c as w,b as U,v as $,e as E,_ as M}from"./index-1cb382aa.js";import{i as b}from"./imageCaptcha-bb6a1aa5.js";import{E as _}from"./element-plus-baf202ae.js";import{d as B,r as p,c as D,Q as r,I as s,u as L,v as S,ag as u,o as F,M as V}from"./@vue-d872a633.js";import"./pinia-cb4be529.js";import"./vue-demi-71ba0ef2.js";import"./pinia-plugin-persistedstate-ed167f96.js";import"./axios-439bb627.js";import"./qs-6612e700.js";import"./side-channel-32a248f0.js";import"./es-errors-c75f5a96.js";import"./object-inspect-110ff94a.js";import"./call-bind-apply-helpers-be8cb158.js";import"./function-bind-48f717dc.js";import"./side-channel-list-1667605c.js";import"./side-channel-map-a9d6574a.js";import"./get-intrinsic-8d8987ad.js";import"./es-object-atoms-11ea1ab9.js";import"./math-intrinsics-9389030e.js";import"./gopd-30775706.js";import"./es-define-property-27915812.js";import"./has-symbols-76fb15e9.js";import"./get-proto-15e8f36b.js";import"./dunder-proto-2a4d8230.js";import"./hasown-31deb62f.js";import"./call-bound-dbfc98a1.js";import"./side-channel-weakmap-a7bef06b.js";import"./vue-router-154b9487.js";import"./@element-plus-11e7d0b3.js";import"./@vueuse-9028f0e6.js";import"./nprogress-72cfee09.js";/* empty css                    */import"./lodash-es-32f1e46b.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-f13f0179.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-5ec34e26.js";const H=B({__name:"resetPassword",props:{visible:{type:Boolean}},emits:["update:visible"],setup(h,{emit:C}){const y=C,x=h,d=R(()=>x.visible,!1),g=p(),n=p(!1),o=p({phone:"",password:"",confirmPassword:"",authCode:"",agent:"1"}),f=p();f.value=w.code_mode===1?/^1\d{10}$/:/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;const m=p();m.value=w.code_mode===1?"手机号":"邮箱";const P={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:f.value,message:`请输入正确的${m.value}`,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:16,message:"长度在 6 到 16 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(c,e,a)=>{e!==o.value.password?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}],authCode:[{required:!0,message:"请输入验证码",trigger:"blur"}],agent:[{required:!0,message:"请选择代理类型",trigger:"blur"}]},v=p(!1),k=async c=>{if(!f.value.test(o.value.phone))return _.error(`请输入正确的${m.value}！`);const e=c.target;b.show(a=>{b.hide(),U({tel:o.value.phone,captcha:a.code,key:a.key}).then(()=>{v.value=!0;const i=function(){let l=e.getAttribute("data-time");l<=0&&(l=60),l--,e.innerHTML=l+"秒后重新获取",e.setAttribute("data-time",l),l>0?setTimeout(i,1e3):(v.value=!1,e.innerHTML="发送验证码")};i()})})},T=()=>{$(g.value).then(()=>{n.value=!0,E({username:o.value.phone,password:o.value.password,password_confirmation:o.value.confirmPassword,captcha:o.value.authCode}).then(()=>{_.success("修改成功，请登录"),d.value=!1}).finally(()=>{n.value=!1})})};return(c,e)=>{const a=u("el-input"),i=u("el-form-item"),l=u("el-button"),q=u("el-form"),A=u("el-drawer");return F(),D("div",null,[r(A,{modelValue:L(d),"onUpdate:modelValue":e[5]||(e[5]=t=>S(d)?d.value=t:null),class:"register_drawer",modal:!1,title:"找回密码",onClose:e[6]||(e[6]=t=>y("update:visible",!1))},{default:s(()=>[r(q,{ref_key:"formRef",ref:g,model:o.value,rules:P,"label-position":"left","label-width":"100px",disabled:n.value},{default:s(()=>[r(i,{prop:"phone",label:m.value},{default:s(()=>[r(a,{modelValue:o.value.phone,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.phone=t),placeholder:"请输入"+m.value},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{prop:"authCode",label:"验证码"},{default:s(()=>[r(a,{modelValue:o.value.authCode,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.authCode=t),placeholder:"请输入验证码"},{suffix:s(()=>[r(l,{class:"code-btn",disabled:v.value,type:"primary",onClick:e[1]||(e[1]=t=>k(t))},{default:s(()=>e[7]||(e[7]=[V("发送验证码")])),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),r(i,{prop:"password",label:"设置新密码"},{default:s(()=>[r(a,{modelValue:o.value.password,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.password=t),"show-password":"",type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),r(i,{prop:"confirmPassword",label:"确认新密码"},{default:s(()=>[r(a,{modelValue:o.value.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.confirmPassword=t),"show-password":"",type:"password",placeholder:"请再次输入密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"]),r(l,{class:"sign-btn",type:"primary",onClick:T},{default:s(()=>e[8]||(e[8]=[V("修改密码")])),_:1})]),_:1},8,["modelValue"])])}}});const qe=M(H,[["__scopeId","data-v-6f489528"]]);export{qe as default};
