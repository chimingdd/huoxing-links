import{d as A,r as c,Y as D,ag as x,o as E,c as H,Q as r,I as d,M as m,a as n,J as _,R as h,u as R,P as W}from"./@vue-d872a633.js";import{M as j}from"./vue-cropper-a8fd63f1.js";import{k as F,_ as T}from"./index-eb0483c8.js";import{E as C}from"./element-plus-baf202ae.js";const $="/web/assets/qqluodi-ee3584c7.png",q={class:"avatar-container"},L={class:"avatar-crop"},z={class:"dialog-footer"},G=A({__name:"tailorUpload",props:{modelValue:{}},emits:["update:modelValue"],setup(J,{emit:k}){const w=c(),B=c(),v=c(),g=c(!1),f=c(!1),o=D({img:"",autoCrop:!0,fixedBox:!1,canMoveBox:!0,autoCropWidth:200,autoCropHeight:200,fixed:!0,fixedNumber:[1,1],centerBox:!0,canMove:!0,canScale:!0,full:!1}),b=k,V=s=>{const e=s.raw.type==="image/jpeg"||s.raw.type==="image/png",a=s.raw.size/1024/1024<5;if(!e)return C.warning("请选择 jpg、png 格式的图片"),!1;if(!a)return C.warning("图片大小不能超过 5MB"),!1;let l=new FileReader;l.readAsDataURL(s.raw),l.onload=u=>{o.img=u.target.result},v.value.clearFiles()},y=()=>{o.img="",g.value=!1},U=(s,e,a)=>{const l=new Image;let u=.8;l.src=s,l.setAttribute("crossOrigin","Anonymous");let i,p;l.onload=function(){i=l.width,p=l.height;const t=document.createElement("canvas"),M=t.getContext("2d");Math.max(i,p)>e?i>p?(t.width=e,t.height=e*p/i):(t.height=e,t.width=e*i/p):(t.width=i,t.height=p,u=.8),M.clearRect(0,0,t.width,t.height),M.drawImage(this,0,0,t.width,t.height);let S=t.toDataURL("image/jpeg",u);a(S)}},I=()=>{w.value.getCropData(s=>{U(s,300,e=>{F({image:e}).then(a=>{f.value=!1,b("update:modelValue",a.path||""),C.success("上传成功"),v.value.clearFiles(),y()}).catch(()=>{f.value=!1})})})},N=()=>{B.value.ref.click()};return(s,e)=>{const a=x("el-button"),l=x("el-upload"),u=x("el-dialog");return E(),H(W,null,[r(a,{type:"primary",onClick:e[0]||(e[0]=i=>g.value=!0)},{default:d(()=>e[2]||(e[2]=[m("上传图片")])),_:1}),r(u,{title:"上传图片",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=i=>g.value=i),"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":"",width:"600px"},{footer:d(()=>[n("div",z,[n("div",{class:"reupload",onClick:N},[_(n("span",null,"重新上传",512),[[h,o.img]])]),n("div",null,[r(a,{onClick:y,loading:f.value},{default:d(()=>e[5]||(e[5]=[m("取 消")])),_:1},8,["loading"]),r(a,{type:"primary",onClick:I,loading:f.value},{default:d(()=>e[6]||(e[6]=[m("确 定")])),_:1},8,["loading"])])])]),default:d(()=>[n("div",q,[_(n("div",null,[r(l,{class:"upload",ref_key:"tailorUpload",ref:v,action:"#","on-change":V,"show-file-list":!1,"auto-upload":!1},{default:d(()=>[r(a,{slot:"trigger",type:"primary",ref_key:"uploadBtn",ref:B},{default:d(()=>e[3]||(e[3]=[m(" 选择图片 ")])),_:1},512)]),_:1},512),e[4]||(e[4]=n("div",null,"支持jpg、png格式的图片，大小不超过5M",-1))],512),[[h,!o.img]]),_(n("div",L,[r(R(j),{class:"crop-box",ref_key:"cropper",ref:w,img:o.img,autoCrop:o.autoCrop,fixedBox:o.fixedBox,canMoveBox:o.canMoveBox,autoCropWidth:o.autoCropWidth,autoCropHeight:o.autoCropHeight,centerBox:o.centerBox,fixed:o.fixed,fixedNumber:o.fixedNumber,canMove:o.canMove,canScale:o.canScale,full:o.full,outputSize:.1,outputType:"png"},null,8,["img","autoCrop","fixedBox","canMoveBox","autoCropWidth","autoCropHeight","centerBox","fixed","fixedNumber","canMove","canScale","full"])],512),[[h,o.img]])])]),_:1},8,["modelValue"])],64)}}});const K=T(G,[["__scopeId","data-v-d634c67f"]]);export{K as T,$ as _};
